import functor MkStamp from "x-alice:/lib/utility/MkStamp"
import functor MkHashImpMap from "x-alice:/lib/utility/MkHashImpMap"

structure X :> 
sig
    val insert : (bool -> bool) -> int
    val lookup : int -> (bool -> bool)
end
=
struct
    local
	structure Stamp = MkStamp()
        structure HashImpMap = MkHashImpMap(Stamp)
        val htable = HashImpMap.new()
    in
        fun insert f = 
	    let
		val id = Stamp.new()
	    in
		( HashImpMap.insert(htable, id, f) ; id )
	    end
	fun lookup id = HashImpMap.lookup(htable, id)
    end
end

