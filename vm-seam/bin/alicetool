#!/bin/sh

set -e

find_in () {
    search_for=$1
    found_in=""
    shift
    for d in "$@"; do
	if test -f "$d/${search_for}" -o -h "$d/${search_for}"; then
	    found_in=$d && break
	fi
    done
    if test -z "${found_in}"; then
	echo "$cmd: error: could not find ${search_for} in either of" >&2
	for d in "$@"; do echo "  $d" >&2; done
	exit 1
    fi
    echo "${found_in}"
}

if [ $# -lt 1 ]; then
    echo "usage: $0 [--verbose|-v] (makedepend|c++|ld) <option> ..." >&2
    exit 2
fi

mode=$1; shift
case "$mode" in
    --verbose|-v)
	verbose=-v
	mode=$1; shift
	;;
    *)
	verbose=
	;;
esac

if test -z "${ALICE_HOME}"; then
  ALICE_HOME=$(dirname $(dirname $0))
fi

case "$mode" in
    makedepend)
	exec seamtool $verbose makedepend -I"$ALICE_HOME"/include "$@"
	;;
    c++)
	exec seamtool $verbose compile -I"$ALICE_HOME"/include "$@"
	;;
    ld)
	exec seamtool $verbose link "$@" "$ALICE_HOME/alice.dll"
	;;
    *)
	echo $0: unknown mode \`$1\' >&2
	exit 2
	;;
esac

exit 0
