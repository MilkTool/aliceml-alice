<?php include("macros.php3"); ?>
<?php heading("The Remote structure",
	      "The <TT>Remote</TT> structure") ?>

<?php section("synopsis", "synopsis") ?>

  <PRE>
    signature REMOTE
    structure Remote : REMOTE</PRE>

  <P>
    This structure provides support for the implementation of distributed
    applications.  This includes exporting values from and importing values
    into sites, performing remote function application and starting a new
    site.  See the <A href="../distribution.html">distribution overview</A>
    for an introduction to the distribution facilities provided by Alice.
  </P>

  <P>
    Communication between sites is performed by <EM>cloning</EM> data
    structures.  Cloning is defined by <A href="pickle.html">pickling</A>.
  </P>

  <P>
    The current implementation uses HTTP as the transport protocol.
    Accordingly, tickets are URLs using the <TT>http</TT> scheme.
  </P>

  <P>
    See also:
    <A href="component-manager.html"><TT>COMPONENT_MANAGER</TT></A>,
    <A href="url.html"><TT>Url</TT></A>,
    <A href="pickle.html"><TT>Pickle</TT></A>
  </P>

<?php section("import", "import") ?>

  <PRE>
    import structure Remote from "x-alice:/lib/distribution/Remote"
    import signature REMOTE from "x-alice:/lib/distribution/REMOTE-sig"</PRE>

<?php section("interface", "interface") ?>

  <PRE>
    signature REMOTE =
    sig
	type <A href="#ticket">ticket</A> = string

	exception <A href="#Proxy-exn">Proxy</A> of exn
	exception <A href="#SitedArgument-exn">SitedArgument</A>
	exception <A href="#SitedResult-exn">SitedResult</A>
	exception <A href="#Protocol">Protocol</A> of string
	exception <A href="#Ticket-exn">Ticket</A>

	val <A href="#proxy">proxy</A> : ('a -> 'b) -> ('a -> 'b)

	val <A href="#offer">offer</A> : <A href="package.html#package">package</A> -> ticket
	val <A href="#take">take</A> : ticket -> <A href="package.html#package">package</A>

	functor <A href="#Offer-fn">Offer</A> (signature S  structure X : S) : (val ticket : ticket)
	functor <A href="#Take-fn">Take</A> (val ticket : ticket  signature S) : S

	functor <A href="#Execute">Execute</A> (val host : string
			 signature RESULT
			 functor Start (ComponentManager : <A href="component-manager.html">COMPONENT_MANAGER</A>) : RESULT) : RESULT
    end</PRE>

<?php section("description", "description") ?>

  <DL>
    <DT>
      <TT>type <A name="ticket">ticket</A> = string</TT>
    </DT>
    <DD>
      <P>The type of tickets representing offered values.  Tickets are
	short strings suitable for communication, for instance, over voice
	lines or by email.  Tickets are suitable for parsing as URLs.</P>
    </DD>

    <DT>
      <TT>exception <A name="Ticket-exn">Ticket</A></TT>
    </DT>
    <DD>
      <P>indicates that a ticket was not well-formed or referred to
	a site or value that could not be accessed.</P>
    </DD>

    <DT>
      <TT>exception <A name="Proxy-exn">Proxy</A> of exn</TT>
    </DT>
    <DD>
      <P>indicates that a call through a proxy has failed. The argument
      exception describes the specific cause of failure.</P>
    </DD>

    <DT>
      <TT>exception <A name="SitedArgument-exn">SitedArgument</A></TT> <BR>
      <TT>exception <A name="SitedResult-exn">SitedResult</A></TT> <BR>
      <TT>exception <A name="Protocol">Protocol</A> of string</TT>
    </DT>
    <DD>
      <P>the former two exceptions indicate that the argument or result of
      a call to a proxy contained a sited value. The third exception
      indicates an internal protocol error during execution of a proxy call,
      where the string describes the error condition in text form.
      These exception are never raised directly, but
      occurs only as the argument of a <TT>Proxy</TT> exception.
    </DD>

    <DT>
      <TT><A name="proxy">proxy</A> <I>f</I></TT>
    </DT>
    <DD>
      <P>returns a proxy for&nbsp;<TT><I>f</I></TT>.  The proxy differs
	from&nbsp;<TT><I>f</I></TT> in that:</P>
      <UL>
	<LI><P>the argument to the proxy is cloned before&nbsp;<TT><I>f</I
	  ></TT> is applied to it; it may not contain sited values;</P>
	<LI><P>the result of&nbsp;<I>f</I> (either a value or an exception)
	  is cloned before it is delivered to the caller; it may not contain
	  sited values;
	<LI><P>whenever the proxy itself is cloned, only a reference to the
	  running site is cloned which does not contain a clone
	  of&nbsp;<TT><I>f</I></TT>;</P>
	<LI><P>when the proxy is applied, no matter on which site, this
	  causes <TT><I>f</I></TT> to be applied on the site on which the
	  proxy was created, if necessary by transferring argument and
	  result between the sites.</P>
      </UL>
      <P>The cloning performed when applying proxies implies that any <A
        href="../futures.html">future</A> in the
        argument value or result is requested. That
	may raise an exception due to a failed future, which then becomes
	the result of the call. In either case, this is
	considered regular execution of the proxy call.</P>
      <P>But proxy calls may also fail, for a number of reasons. In each case,
        the exception <TT><A href="#Proxy-exn">Proxy</A></TT> is raised to
	indicate failed execution of the call, with the actual cause as an
	argument. The following causes are possible:</P>
      <UL>
	<LI><P>The argument to the proxy contains a sited value. In that
	  case, <TT>Proxy(<A
	  href="#SitedArgument-exn">SitedArgument</A>)</TT> will be
	  raised.</P>
	<LI><P>The result of applying <TT>f</TT> (a value or raised exception)
	  contains a sited value, or it contains a failed future that
	  carries an exception with a sited value or another failed
	  future. In all cases, <TT>Proxy(<A
	  href="#SitedResult-exn">SitedResult</A>)</TT> will be raised.
	  (Secondary failed futures are captured to prevent divergence in
	  the case of circular data structures.)</P>
	<LI><P>The process in which the proxy was created has terminated.
	  In this case, <TT>Proxy(<A 
	  href="#Ticket-exn">Ticket</A>)</TT> will be raised.</P>
	<LI><P>A protocol failure occurs in the lower communication layers.
	  In this case, <TT>Proxy(<A 
	  href="#Protocol-exn">Protocol</A> <I>s</I>)</TT> will be raised,
	  with <TT><I>s</I></TT> describing the error condition.</P>
	<LI><P>An I/O problem occurs in the lower communication layers.
	  In this case, <TT>Proxy(<A 
	  href="io.html">Io</A> <I>args</I>)</TT> will be raised, with
	  <TT><I>args</I></TT> carrying further information.</P>
      </UL>
      <P>Other causes for raising <TT>Proxy</TT> are possible.</P>
    </DD>

    <DT>
      <TT><A name="offer">offer</A> <I>package</I></TT>
    </DT>
    <DD>
      <P>makes <TT><I>package</I></TT> available to other sites for taking.
	Returns a ticket suitable for <TT><A href="#take">take</A></TT>
	or <TT><A href="#Take-fn">Take</A></TT>.
	An offered package can be taken any number of times.
	If the package contains mutable data, then each
	<TT><A href="#take">take</A></TT> will return a clone of
	a snapshot of the package made when offer is executed.</P>
    </DD>

    <DT>
      <TT><A name="take">take</A> <I>ticket</I></TT>
    </DT>
    <DD>
      <P>imports the data structure denoted by <TT><I>ticket</I></TT>, which
	must have been created by <TT><A href="#offer">offer</A></TT>
	or <TT><A href="#Offer-fn">Offer</A></TT>.  Raises
	<TT><A href="#Ticket-exn">Ticket</A></TT> if the ticket is
	invalid or the site on which it was created no longer exists.
	Raises <TT><A href="io.html">IO.Io</A></TT> if retrieving the
	package fails for other reasons.</P>
    </DD>

    <DT>
      <TT><A name="Offer-fn">Offer</A> (signature S = <I>S</I>
	structure X = <I>X</I>)</TT>
    </DT>
    <DD>
      <P>makes module <TT><I>X</I></TT> available to other sites for taking with
	signature&nbsp;<I>S</I>.  Returns a ticket suitable for <TT><A
	href="#take">take</A></TT> or <TT><A href="#Take-fn">Take</A></TT>.
	Equivalent to</P>
        <PRE>
	(val ticket = offer (pack <I>X</I> :> <I>S</I>))</PRE>
    </DD>

    <DT>
      <TT><A name="Take-fn">Take</A> (val ticket = <I>ticket</I>
	signature S = <I>S</I>)</TT>
    </DT>
    <DD>
      <P>imports the module denoted by <TT><I>ticket</I></TT>, which
	must have been created by <TT><A href="#offer">offer</A></TT> or <TT
	><A href="#Offer-fn">Offer</A></TT>, under a sub-signature
	of&nbsp;<TT><I>S</I></TT>.
	Raises <TT><A href="#Ticket-exn">Ticket</A></TT> if the
	ticket is invalid or the site on which it was created no longer
	exists.  Raises <TT><A href="package.html#Mismatch">Package.Mismatch</A
	></TT> if the module was not exported with a signature matching&nbsp;<TT
	><I>S</I></TT>. Raises <TT><A href="io.html">IO.Io</A></TT> if
	retrieving the module fails for other reasons.
	Equivalent to</P>
        <PRE>
	unpack (take <I>ticket</I>) : <I>S</I></PRE>
    </DD>

    <DT>
      <TT><A name="Execute">Execute</A> (val host = <I>host</I>
	signature RESULT = <I>S</I>
	functor Start = <I>F</I>)</TT>
    </DT>
    <DD>
      <P>creates a new site on <TT><I>host</I></TT> using <TT>ssh</TT>,
	transfers a clone of <TT><I>Start</I></TT> to the new site, on which
	it is applied to the local component manager.  A clone of the resulting
	structure is transferred back to the caller of <TT>Execute</TT> and
	returned as the resulting structure.</P>
    </DD>
  </DL>

<?php footing() ?>
